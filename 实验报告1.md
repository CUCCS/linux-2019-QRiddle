# 实验一

## 实验目标
- [x] Virtualbox安装完Ubuntu之后新添加的网卡如何实现系统开机自动启用和自动获取IP？
- [x] 如何使用sftp在虚拟机和宿主机之间传输文件？
- [x] 如何配置无人值守安装iso并在Virtualbox中完成自动化安装

## 实验环境
设备
- 主机：macOS Mojave
- 虚拟机：ubuntu-18.04.1-server-amd64

网络配置
- VirtualBox
- ubuntu-18.04.1-server-amd64

## 实验过程

1. 如何配置无人值守安装iso并在Virtualbox中完成自动化安装。
- 下载原iso文件

		wget http://old-releases.ubuntu.com/releases/18.04.0/ubuntu-18.04.1-server-amd64.iso

- 在当前用户目录下创建一个用于挂载iso镜像文件的目录

		mkdir loopdir
![](https://github.com/CUCCS/linux-2019-QRiddle/blob/homework1/image/屏幕快照%202019-03-14%20下午1.58.57.png?raw=true)
- 挂载iso镜像文件到该目录

	 	mount -o loop ubuntu-18.04.1-server-amd64.iso loopdir

- 创建一个工作目录用于克隆光盘内容

		mkdir cd

- 同步光盘内容到目标工作目录

		rsync -av loopdir/ cd

- 卸载iso镜像

		umount loopdir

- 进入cd工作目录下，编辑Ubuntu安装引导界面以增加一个新菜单项入口

		# 进入cd工作目录下
		cd ~/cd
		# 打开文件
		vim isolinux/txt.cfg
		# 添加以下内容到该文件后强制保存退出
		label autoinstall
	 	 menu label ^Auto Install Ubuntu Server
	 	 kernel /install/vmlinuz
	 	 append  file=/cdrom/preseed/ubuntu-server-autoinstall.seed debian-installer/locale=en_US console-setup/layoutcode=us keyboard-configuration/layoutcode=us console-setup/ask_detect=false localechooser/translation/warn-light=true localechooser/translation/warn-severe=true initrd=/install/initrd.gz root=/dev/ram rw quiet

	![](https://github.com/CUCCS/linux-2019-QRiddle/blob/homework1/image/屏幕快照%202019-03-14%20下午3.25.25.png?raw=true)

- 将配置完成的ubuntu-server-autoinstall.seed的移到 ~/cd/preseed 目录中

- 修改isolinux/isolinux.cfg，增加内容timeout 10
		sudo vim isolinux/isolinux.cfg
![](https://github.com/CUCCS/linux-2019-QRiddle/blob/homework1/image/屏幕快照%202019-03-14%20下午3.38.05.png?raw=true)

- 重新生成md5sum.txt，由于权限不够，所以先对要操作的文件进行提权

		sudo chmod 777 md5sum.txt
		find . -type f -print0 | xargs -0 md5sum > md5sum.txt

- 安装genisoimage

		apt-get install genisoimage

	![](https://github.com/CUCCS/linux-2019-QRiddle/blob/homework1/image/屏幕快照%202019-03-14%20下午3.59.35.png?raw=true)

- 封闭改动后的目录到.iso

		IMAGE=custom.iso
		BUILD=~/cd/

		mkisofs -r -V "Custom Ubuntu Install CD" \
            -cache-inodes \
            -J -l -b isolinux/isolinux.bin \
            -c isolinux/boot.cat -no-emul-boot \
            -boot-load-size 4 -boot-info-table \
            -o $IMAGE $BUILD

- 执行shell命令

	![](https://github.com/CUCCS/linux-2019-QRiddle/blob/homework1/image/屏幕快照%202019-03-14%20下午4.00.34.png?raw=true)

- 将生成的无人值守镜像下载到宿主机中

	get /home/cuc/cd/custom.iso /Users/malaoban/Desktop/MYX 

	![](https://github.com/CUCCS/linux-2019-QRiddle/blob/homework1/image/屏幕快照%202019-03-14%20下午4.13.18.png?raw=true)




2. Virtualbox安装完Ubuntu之后新添加的网卡如何实现系统开机自动启用和自动获取IP？

- 打开配置文件

		vim /etc/netplan/01-netcfg.yaml

- 修改配置文件 加入以下内容并保存

		auto enp0s8
		iface enp0s8 inet dhcp

- 应用改变

		sudo netplan apply


3. 如何使用sftp在虚拟机和宿主机之间传输文件？

	 	连接虚拟机进行sftp
			stfp 用户名@IP地址

	![](https://github.com/CUCCS/linux-2019-QRiddle/blob/homework1/image/屏幕快照%202019-03-14%20下午4.13.18.png?raw=true)
	
## 参考资料
- [CUCCS/linux-2019-jackcily](https://github.com/CUCCS/linux-2019-jackcily/blob/job1/job1/实验一.md)
- [CUCCS/linux-2019-Lyc-heng](https://github.com/CUCCS/linux-2019-Lyc-heng/blob/chap0x01/chap0x01/chap0x01.md)
